{% extends 'base.html' %}

{% block content %}

{% for message in get_flashed_messages() %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endfor %}

<br/>
{% for post in posts %}
<div class="shadow p-3 mb-5 bg-body-tertiary rounded">
    <h2><a href="{{ url_for('post', id=post.id) }}">{{ post.title }}</a><br/></h2>
    <small>By: {{ post.poster.name }}<br/>
    {{ post.date_posted.strftime('%Y-%m-%d') }}</small><br/><br/>

    {{ post.content | safe }}<br/><br/>
    <div>
    {% if current_user.is_authenticated %}
    <!-- Upvote form -->
    <form action="{{ url_for('upvote_post', id=post.id) }}" method="POST" style="display:inline;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="btn btn-sm btn-success">Upvote</button>
    </form>
    <!-- Downvote form -->
    <form action="{{ url_for('downvote_post', id=post.id) }}" method="POST" style="display:inline;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="btn btn-sm btn-danger">Downvote</button>
    </form>
    {% else %}
    <button type="button" class="btn btn-sm btn-success" onclick="alert('Please log in to vote');">Upvote</button>
    <button type="button" class="btn btn-sm btn-danger" onclick="alert('Please log in to vote');">Downvote</button>
    {% endif %}
    <span>Score: {{ post.score() }}</span>
</div>
    <br/><br/>
    <a href="{{ url_for('post', id=post.id) }}" class="btn btn-outline-secondary btn-sm"> View Post</a>

    {% if post.poster_id == current_user.id or current_user.id == 13 %}
    <a href="{{ url_for('edit_post', id=post.id) }}" class="btn btn-outline-secondary btn-sm"> Edit Post</a>
    <form action="{{ url_for('delete_post', id=post.id) }}" method="post" style="display:inline;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="btn btn-outline-danger btn-sm">Delete Post</button>
    </form>
    {% endif %}

    <br/>
</div>
<br/>
{% endfor %}

{% endblock %}
