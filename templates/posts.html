{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<title>Posts</title>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Posts</h1>

    <!-- Sorting Options -->
    <div class="sorting-options mb-3">
        <form method="get" action="{{ url_for('posts') }}" class="form-inline">
            <select name="sort" class="form-control" onchange="this.form.submit()">
                <option value="date" {% if request.args.get('sort') == 'date' %}selected{% endif %}>Date Added</option>
                <option value="score" {% if request.args.get('sort') == 'score' %}selected{% endif %}>Vote Score</option>
            </select>
        </form>
    </div>

    <!-- Posts Display -->
    {% for post in posts %}
    <div class="post-card" style="display: flex; align-items: start; margin-bottom: 20px;">
         <!-- Voting Section -->
        <div class="voting-buttons" style="margin-right: 20px; display: flex; flex-direction: column; align-items: center;">
            <form action="{{ url_for('upvote_post', id=post.id) }}" method="post" style="margin-bottom: 5px;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="vote-button upvote-button">
                    <i class="fa fa-arrow-up" aria-hidden="true"></i>
                </button>
            </form>
            <div style="font-size: 18px; color: #333;">{{ post.score }}</div>
            <form action="{{ url_for('downvote_post', id=post.id) }}" method="post" style="margin-top: 5px;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="vote-button downvote-button">
                    <i class="fa fa-arrow-down" aria-hidden="true"></i>
                </button>
            </form>
        </div>
        <!-- Clickable Post Content -->
        <!-- Clickable Post Content -->
        <a href="{{ url_for('post', id=post.id) }}" style="flex-grow: 1; color: inherit; text-decoration: none;">
            <div>
                <h5 class="post-title">{{ post.title }}</h5>
                <div class="post-meta">{{ post.date_posted.strftime('%Y-%m-%d') }} by {{ post.poster.name }}</div>
                <p class="post-content">{{ post.content | truncate(150, True, '...') | safe }}
            </div>
        </a>
    </div>
    {% else %}
    <p>No posts available.</p>
    {% endfor %}
</div>
{% endblock %}
